
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Usage &#8212; confounds 0.1.1+0.g739ec48.dirty documentation</title>
    <link rel="stylesheet" href="_static/pd.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="API.html" />
    <link rel="prev" title="Installation" href="installation.html" />
    <script type="text/javascript" src="_static/pd.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

  </head><body>
    <div id="header">
        <h1>confounds 0.1.1+0.g739ec48.dirty documentation</h1>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
        <ul>
            <li class="nav-item nav-item-0"><a href="index.html">confounds 0.1.1+0.g739ec48.dirty documentation</a> &#187;
            </li>
        </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>To use the <code class="docutils literal notranslate"><span class="pre">confounds</span></code> library in a project, import the necessary classes or functions e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">confounds</span> <span class="kn">import</span> <span class="n">Residualize</span><span class="p">,</span> <span class="n">Augment</span><span class="p">,</span> <span class="n">DummyDeconfounding</span>
</pre></div>
</div>
<div class="section" id="example-usage">
<h2>Example usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h2>
<p>Let’s say the features from your dataset are contained in <code class="docutils literal notranslate"><span class="pre">X</span></code> (N x p), and the confounds/covariates for those samples stored in <code class="docutils literal notranslate"><span class="pre">C</span></code> (of size N x c), with X and C having row-wise correspondence for each samplet.</p>
<p>X is often split into <code class="docutils literal notranslate"><span class="pre">train_X</span></code> and <code class="docutils literal notranslate"><span class="pre">test_X</span></code> inside the cross-validation loop, and the corresponding splits for C are <code class="docutils literal notranslate"><span class="pre">train_C</span></code> and <code class="docutils literal notranslate"><span class="pre">test_C</span></code>. Then, the estimator classes (e.g. <code class="docutils literal notranslate"><span class="pre">Residualize()</span></code>) from <code class="docutils literal notranslate"><span class="pre">confounds</span></code> library are used in the following <strong>easy</strong> manner:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">resid</span> <span class="o">=</span> <span class="n">Residualize</span><span class="p">()</span>          <span class="c1"># instantiation</span>
<span class="c1"># NOTE the second argument to deconfounding instance are confounds/covariate variables, not y (targets)</span>
<span class="n">resid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_C</span><span class="p">)</span>    <span class="c1"># training on X and C</span>

<span class="c1"># NOTE the second argument to the instance are confounds/covariate variables, not y (targets)</span>
<span class="n">deconf_train_X</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_C</span><span class="p">)</span>     <span class="c1"># deconfounding X, N</span>
<span class="n">deconf_test_X</span>  <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_X</span> <span class="p">,</span> <span class="n">test_C</span><span class="p">)</span>
</pre></div>
</div>
<p>That’s it.</p>
<p>You can also replace <code class="docutils literal notranslate"><span class="pre">Residualize()</span></code> with <code class="docutils literal notranslate"><span class="pre">Augment()</span></code> (which simply concatenates the covariates values to X horizontally) as well as <code class="docutils literal notranslate"><span class="pre">DummyDeconfounding()</span></code> which does nothing but return X back.</p>
<p>Here is an broader example showing how the deconfouding classes can be used in a full cross-validation loop:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_CV_iters</span><span class="p">):</span>

    <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">,</span> <span class="n">original_test_targets</span> <span class="o">=</span> <span class="n">split_dataset</span><span class="p">(</span><span class="n">your_dataset</span><span class="p">,</span> <span class="nb">iter</span><span class="p">)</span>
    <span class="c1"># split_dataset() could be train_test_split from sklearn for simple flat numpy-array based feature set</span>
    <span class="c1">#   (which I discourage in favour of pyradigm)</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_C</span><span class="p">,</span> <span class="n">test_X</span> <span class="p">,</span> <span class="n">test_C</span> <span class="o">=</span> <span class="n">get_covariates</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

    <span class="n">resid</span> <span class="o">=</span> <span class="n">Residualize</span><span class="p">()</span>
    <span class="n">resid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_C</span><span class="p">)</span>
    <span class="c1"># NOTE 2nd argument here are covariates, not y (targets)</span>
    <span class="n">deconf_train_X</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_C</span><span class="p">)</span>
    <span class="n">deconf_test_X</span>  <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_X</span> <span class="p">,</span> <span class="n">test_C</span><span class="p">)</span>

    <span class="c1"># wrapper containing calls to GridSearchCV() etc</span>
    <span class="c1"># pipeline here is the predictive model, sequence of sklearn estimators</span>
    <span class="n">best_pipeline</span> <span class="o">=</span> <span class="n">optimize_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">deconf_train_X</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">)</span>
    <span class="n">predicted_test_targets</span> <span class="o">=</span> <span class="n">best_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">deconf_test_X</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="nb">iter</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluate_performance</span><span class="p">(</span><span class="n">predicted_test_targets</span><span class="p">,</span> <span class="n">original_test_targets</span><span class="p">)</span>
</pre></div>
</div>
<p>If the above example is confusing or you disagree with it, please <a class="reference external" href="https://github.com/raamana/confounds/issues/new">let me know</a>. Appreciate your help in improving the methods and documentation. Thanks much!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only <code class="docutils literal notranslate"><span class="pre">Residualize(model='linear')</span></code>, <code class="docutils literal notranslate"><span class="pre">Augment()</span></code> and <code class="docutils literal notranslate"><span class="pre">DummyDeconfounding()</span></code> are considered usable. The rest are yet to be developed, and subject to change without notice.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Scikit-learn does not offer the ability to pass in covariates (or any other variables) besides <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> to their estimators. So, although classes from this <code class="docutils literal notranslate"><span class="pre">confounds</span></code> library act as scikit-learn estimators (passing estimator checks), <strong>they should NOT be used in a pipeline</strong> e.g. to pass it on <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> or similar convenience classes for optimization purposes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I highly recommend using the <code class="docutils literal notranslate"><span class="pre">pyradigm</span></code> data structure to manage the features and covariates of a given dataset, using the classes <code class="docutils literal notranslate"><span class="pre">ClassificationDataset</span></code> and <code class="docutils literal notranslate"><span class="pre">RegressionDataset</span></code>. The development version of <code class="docutils literal notranslate"><span class="pre">pyradigm</span></code> provides the <code class="docutils literal notranslate"><span class="pre">MultiDatasetClassify</span></code> and <code class="docutils literal notranslate"><span class="pre">MultiDatasetRegress</span></code> classes that would make this data management even easier when engaging in comparisons across multiple modalities/feature-sets on the same sample (same subjects with same covariates).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#example-usage">Example usage</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="API.html"
                        title="next chapter">API</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/usage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Pradeep Reddy Raamana.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>